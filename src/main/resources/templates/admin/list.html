<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skincare Booking System</title>
    <link rel="stylesheet" th:href="@{/assets/themify-icons-font/themify-icons/themify-icons.css}">
    <link rel="stylesheet" th:href="@{/assets/css/styles.css}">
    <link rel="stylesheet" th:href="@{/assets/css/list.css}">
</head>
<body>
<div id="system">
    <div th:replace="~{admin/index :: header}"></div>
    <div id="slidebar">
        <div th:replace="~{admin/index :: navbar}"></div>
        <div class="content">
            <h2>
            </h2>
            <div class="container">
                <h2>Danh s√°ch dich v·ª•</h2>
                <div class="top-bar">
                    <button class="add-service-btn" onclick="openForm()">+ Th√™m D·ªãch V·ª•</button>
                </div>

                <div class="container2">
                    <table>
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>T√™n d·ªãch v·ª•</th>
                            <th>M√¥ t·∫£</th>
                            <th>Gi√°</th>
                            <th>Th·ªùi l∆∞·ª£ng</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        </tbody>
                    </table>
                </div>

            </div>
            <div class="form-popup" id="serviceForm">
                <div class="form-container">
                    <span class="close-btn" onclick="closeForm()">&#10006;</span>
                    <h3>Th√™m D·ªãch V·ª• M·ªõi</h3>
                    <label for="ServiceName">T√™n d·ªãch v·ª•:</label>
                    <input type="text" id="ServiceName" placeholder="Nh·∫≠p t√™n d·ªãch v·ª•">

                    <label for="Descriptions">M√¥ t·∫£:</label>
                    <input type="text" id="Descriptions" placeholder="Nh·∫≠p m√¥ t·∫£">

                    <label for="Price">Gi√°:</label>
                    <input type="text" id="Price" placeholder="Nh·∫≠p gi√°">

                    <label for="Duration">Th·ªùi l∆∞·ª£ng:</label>
                    <input type="text" id="Duration" placeholder="Nh·∫≠p th·ªùi l∆∞·ª£ng">
                    <!-- N√∫t OK -->
                    <button class="ok-btn" type="button" onclick="addService()">OK</button>
                </div>
            </div>

            <script>
                // M·ªü form ƒë·ªÉ th√™m d·ªãch v·ª•
                function openForm() {
                    document.getElementById("serviceForm").style.display = "block";
                }

                // ƒê√≥ng form
                function closeForm() {
                    document.getElementById("serviceForm").style.display = "none";
                }

                // Th√™m d·ªãch v·ª•
                function addService() {
                    var name = document.getElementById("ServiceName").value;
                    var description = document.getElementById("Descriptions").value;
                    var price = document.getElementById("Price").value;
                    var duration = document.getElementById("Duration").value;

                    // Ki·ªÉm tra n·∫øu c√°c tr∆∞·ªùng th√¥ng tin tr·ªëng
                    if (
                        name === "" ||
                        description === "" ||
                        price === "" ||
                        duration === ""
                    ) {
                        alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!");
                        return;
                    }

                    // T·∫°o ƒë·ªëi t∆∞·ª£ng d·ªØ li·ªáu d·ªãch v·ª•
                    var serviceData = {
                        name: name,
                        description: description,
                        price: parseFloat(price),
                        duration: parseInt(duration),
                    };

                    /// üëá D√°n access_token b·∫°n l·∫•y t·ª´ Postman v√†o ƒë√¢y
                    var accessToken = "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJuaXRAZ21haWwuY29tIiwic2NvcGUiOiIiLCJpc3MiOiJza2luY2FyZWJvb2tpbmdzeXN0ZW0ubmhvbV9qYXZhIiwiZXhwIjoxNzQ0NjQ0ODIyLCJpYXQiOjE3NDQ2NDEyMjIsImp0aSI6IjZiMzMyYmVmLWViYTUtNDMxMC1iNmZiLTYzOTE3ZDNjNDUwZSJ9.37tZTdtJezYBxSMZnfsxOb6gxjzq4hjghSeKwoHKSS_Mj7EoIyRxi0oBZ0hYHSvEy7BtLyrP2oINYwENOGbZiA";

                    // G·ª≠i y√™u c·∫ßu POST t·ªõi backend
                    fetch("http://localhost:8080/skin/services", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "Authorization": accessToken
                        },
                        body: JSON.stringify(serviceData),
                    })
                        .then((response) => {
                            if (response.ok) {
                                return response.json();
                            } else {
                                // L·∫•y th√¥ng tin l·ªói t·ª´ response
                                return response.text().then((text) => {
                                    throw new Error(text || "L·ªói t·ª´ Server");
                                });
                            }
                        })
                        .then((data) => {
                            // Th√™m d·ªãch v·ª• v√†o b·∫£ng
                            var table = document.querySelector("table tbody");
                            var newRow = table.insertRow();

                            var idCell = newRow.insertCell(0);
                            var nameCell = newRow.insertCell(1);
                            var descriptionCell = newRow.insertCell(2);
                            var priceCell = newRow.insertCell(3);
                            var durationCell = newRow.insertCell(4);

                            // S·ª≠ d·ª•ng d·ªØ li·ªáu t·ª´ response
                            idCell.innerHTML = data.serviceId || table.rows.length;
                            nameCell.innerHTML = data.name || name;
                            descriptionCell.innerHTML = data.description || description;
                            priceCell.innerHTML = data.price || price;
                            durationCell.innerHTML = data.duration || duration;

                            // X√≥a d·ªØ li·ªáu trong form
                            document.getElementById("ServiceName").value = "";
                            document.getElementById("Descriptions").value = "";
                            document.getElementById("Price").value = "";
                            document.getElementById("Duration").value = "";

                            // ƒê√≥ng form
                            closeForm();

                            // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
                            alert("Th√™m d·ªãch v·ª• th√†nh c√¥ng!");
                        })
                        .catch((error) => {
                            console.error("Error:", error);
                            alert("ƒê√£ x·∫£y ra l·ªói khi th√™m d·ªãch v·ª•: " + error.message);
                        });
                }

                //L·∫•y danh s√°ch d·ªãch v·ª• khi trang ƒë∆∞·ª£c t·∫£i
                window.onload = function () {
                    var accessToken = "Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJuaXRAZ21haWwuY29tIiwic2NvcGUiOiIiLCJpc3MiOiJza2luY2FyZWJvb2tpbmdzeXN0ZW0ubmhvbV9qYXZhIiwiZXhwIjoxNzQ0NjQ0ODIyLCJpYXQiOjE3NDQ2NDEyMjIsImp0aSI6IjZiMzMyYmVmLWViYTUtNDMxMC1iNmZiLTYzOTE3ZDNjNDUwZSJ9.37tZTdtJezYBxSMZnfsxOb6gxjzq4hjghSeKwoHKSS_Mj7EoIyRxi0oBZ0hYHSvEy7BtLyrP2oINYwENOGbZiA";
                  fetch("http://localhost:8080/skin/services", {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": accessToken
                    },
                  })
                          .then((response) => {
                            if (!response.ok) {
                              throw new Error("L·ªói khi t·∫£i d·ªØ li·ªáu: " + response.status);
                            }

                            return response.text().then((text) => {
                              if (!text) {
                                throw new Error("Ph·∫£n h·ªìi r·ªóng t·ª´ server.");
                              }
                              return JSON.parse(text);
                            });
                          })
                          .then((data) => {
                            if (
                                    data.result &&
                                    Array.isArray(data.result) &&
                                    data.result.length > 0
                            ) {
                              var table = document.querySelector("table tbody");
                              table.innerHTML = "";

                              data.result.forEach((service) => {
                                var newRow = table.insertRow();
                                var idCell = newRow.insertCell(0);
                                var nameCell = newRow.insertCell(1);
                                var descriptionCell = newRow.insertCell(2);
                                var priceCell = newRow.insertCell(3);
                                var durationCell = newRow.insertCell(4);

                                idCell.innerHTML = service.serviceId;
                                nameCell.innerHTML = service.name;
                                descriptionCell.innerHTML = service.description;
                                priceCell.innerHTML = service.price;
                                durationCell.innerHTML = service.duration;
                              });
                            } else {
                              alert("Kh√¥ng c√≥ d·ªãch v·ª• n√†o.");
                            }
                          })
                          .catch((error) => {
                            console.error("Error loading services:", error);
                            alert("ƒê√£ x·∫£y ra l·ªói khi t·∫£i danh s√°ch d·ªãch v·ª•: " + error.message);
                          });
                };
            </script>
        </div>
    </div>
    <div th:replace="~{admin/index :: footer}"></div>
</div>

</body>
</html>